### Install

```shell
go get github.com/jpillora/overseer
```

### NOTE

在Nginx-UI中，实现应用更新的操作是在`internal/upgrader/upgrade.go`实现的

需要实现这个功能的时候记得去看这个项目的代码

### overseer.Config

`overseer.Config` 是 `overseer` 库的配置结构体，它定义了如何启动、管理和更新你的应用程序。以下是 `Config` 的每个字段的详细作用说明：

------

#### **1. `Required`**

- **类型**: `bool`
- 作用: 指定是否强制启用 `overseer` 的管理功能。
  - **`true`**：程序必须运行在 `overseer` 管理下。如果未使用 `overseer`，程序将立即退出。
  - **`false`**：允许程序在没有 `overseer` 管理的情况下独立运行。
- **使用场景**: 用于强制确保服务始终在 `overseer` 的父进程环境中运行。

------

#### **2. `Program`**

- **类型**: `func(state State)`
- 作用: 指定实际业务逻辑的入口函数。
  - `state` 参数提供运行时状态信息，例如监听器、文件描述符等。
  - 你需要在此函数中实现主要服务逻辑，比如 HTTP 服务的监听和处理。
- **使用场景**: 所有业务逻辑都需要通过这个函数实现。`overseer` 会在重启时调用此函数。

------

#### **3. `Address`**

- **类型**: `string`
- 作用: 指定应用程序监听的地址（例如 `:8080`）
  - `Address` 是简化配置的方式，等价于 `Addresses` 的单地址版本。
- **使用场景**: 如果服务只需要绑定一个地址（例如 HTTP 服务监听一个端口），可以直接使用这个字段。

------

#### **4. `Addresses`**

- **类型**: `[]string`
- 作用: 指定应用程序需要监听的多个地址。
  - 例如，可以同时监听 `:8080` 和 `127.0.0.1:9090`。
  - `Addresses` 优先于 `Address`。如果两个字段都设置，`Addresses` 将覆盖 `Address`。
- **使用场景**: 适用于需要同时监听多个端口的服务。

------

#### **5. `RestartSignal`**

- **类型**: `os.Signal`
- 作用: 指定用于触发服务重启的信号。
  - 默认值通常是 `syscall.SIGHUP`。
  - 当收到指定信号时，`overseer` 会优雅地重启服务。
- **使用场景**: 自定义用于重启的信号，比如在特定运维场景下使用自定义的信号。

------

#### **6. `TerminateTimeout`**

- **类型**: `time.Duration`
- 作用: 指定旧进程在优雅关闭时的超时时间。
  - 当启动新进程后，旧进程需要在指定时间内完成清理并退出。
  - 如果超时，旧进程将被强制终止。
- **默认值**: 通常为 `10s`。
- **使用场景**: 确保重启时旧服务不会长时间占用资源，同时允许有足够的时间完成未处理的请求。

------

#### **7. `MinFetchInterval`**

- **类型**: `time.Duration`
- 作用: 指定最短的更新检查间隔时间。
  - `overseer` 会定期检查是否有新的版本可以更新。
  - 这个字段控制检查的频率，避免频繁访问更新源。
- **使用场景**: 设置一个合理的间隔（如 `1m` 或 `5m`）以减少带宽浪费。

------

#### **8. `PreUpgrade`**

- **类型**: `func(tempBinaryPath string) error`
- 作用: 在更新二进制文件之前执行的钩子函数。
  - `tempBinaryPath` 是新下载的临时二进制文件路径。
  - 返回 `nil` 表示可以继续更新，返回错误则终止更新。
- **使用场景**: 可以用来校验更新文件的完整性（如校验哈希值）或执行其他预处理逻辑。

------

#### **9. `Debug`**

- **类型**: `bool`
- 作用: 启用调试日志输出。
  - 启用后，`overseer` 会打印更多的调试信息（如进程启动、更新检查等）。
- **使用场景**: 在开发和调试阶段使用，以查看 `overseer` 的内部状态和行为。

------

#### **10. `NoWarn`**

- **类型**: `bool`
- 作用: 禁用非关键性警告日志。
  - 启用后，`overseer` 不会打印一些不重要的警告信息。
- **使用场景**: 在生产环境下减少日志噪声。

------

#### **11. `NoRestart`**

- **类型**: `bool`
- 作用: 禁止服务在运行期间被重启。
  - 如果设置为 `true`，即使收到重启信号或有更新，服务也不会自动重启。
- **使用场景**: 用于测试或调试环境，防止重启干扰。

------

#### **12. `NoRestartAfterFetch`**

- **类型**: `bool`
- 作用: 禁止在下载新的二进制文件后自动重启服务。
  - 启用后，新版本下载完成后不会立即生效，需要手动重启。
- **使用场景**: 在需要手动控制重启时使用，例如需要先验证更新文件的正确性。

------

#### **13. `Fetcher`**

- **类型**: `fetcher.Interface`
- 作用: 用于实现自定义更新逻辑的接口。
  - `overseer` 提供了多种 `Fetcher` 实现（例如从 URL 拉取文件、从文件系统加载更新等）。
  - 你也可以实现自己的 `Fetcher` 来从其他源（如数据库、远程存储）获取更新。
- **使用场景**: 用于定义更新来源和下载策略。